<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ecos de Aetherion - First Person</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700;900&family=Inter:wght@300;400;600;800&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: none;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        :root {
            --primary: #d4af37;
            --dark: #0a0a0f;
            --light: #e8e8e8;
            --ui-bg: rgba(10, 10, 15, 0.95);
        }

        body {
            overflow: hidden;
            background: #000;
            font-family: 'Inter', sans-serif;
            color: var(--light);
        }

        /* Canvas Principal - Raycasting */
        #gameCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            image-rendering: pixelated;
        }

        /* UI Layer */
        #uiLayer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            pointer-events: none;
        }

        /* Telas */
        .screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            z-index: 20;
            pointer-events: auto;
        }

        .screen.active {
            display: flex;
        }

        /* Menu Principal */
        #mainMenu {
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #1a1025 0%, #0d0612 100%);
        }

        .game-title {
            font-family: 'Cinzel', serif;
            font-size: clamp(2.5rem, 8vw, 5rem);
            background: linear-gradient(180deg, #ffd700, #d4af37);
        }

        .game-title {
            font-family: 'Cinzel', serif;
            font-size: clamp(2.5rem, 8vw, 5rem);
            background: linear-gradient(180deg, #ffd700, #d4af37);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 40px rgba(212,175,55,0.4);
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.1rem;
            color: #8b9dc3;
            letter-spacing: 0.3em;
            margin-bottom: 50px;
        }

        .menu-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 90%;
            max-width: 400px;
        }

        .menu-btn {
            background: rgba(212,175,55,0.15);
            border: 2px solid rgba(212,175,55,0.4);
            color: var(--light);
            padding: 18px 30px;
            font-family: 'Cinzel', serif;
            font-size: 1rem;
            letter-spacing: 0.15em;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
        }

        .menu-btn:hover {
            background: rgba(212,175,55,0.3);
            transform: translateX(8px);
        }

        /* HUD Primeira Pessoa */
        .fp-hud {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        /* Crosshair */
        .crosshair {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
        }

        .crosshair::before, .crosshair::after {
            content: '';
            position: absolute;
            background: rgba(255,255,255,0.8);
        }

        .crosshair::before {
            width: 2px;
            height: 20px;
            left: 9px;
            top: 0;
        }

        .crosshair::after {
            width: 20px;
            height: 2px;
            left: 0;
            top: 9px;
        }

        .crosshair-dot {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #ffd700;
            border-radius: 50%;
            top: 8px;
            left: 8px;
        }

        /* Barras de Status */
        .status-bars {
            position: absolute;
            bottom: 30px;
            left: 30px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            background: var(--ui-bg);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .bar-row {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.8rem;
        }

        .bar-icon {
            width: 20px;
            text-align: center;
        }

        .bar-container {
            width: 150px;
            height: 12px;
            background: rgba(0,0,0,0.6);
            border-radius: 6px;
            overflow: hidden;
        }

        .bar-fill {
            height: 100%;
            transition: width 0.3s ease;
            border-radius: 6px;
        }

        .health { background: linear-gradient(90deg, #8b0000, #ff4444); }
        .hunger { background: linear-gradient(90deg, #8b4513, #ff6b35); }
        .thirst { background: linear-gradient(90deg, #0066cc, #4ecdc4); }
        .energy { background: linear-gradient(90deg, #666600, #ffff00); }

        /* Invent√°rio R√°pido */
        .hotbar {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
            background: var(--ui-bg);
            padding: 10px;
            border-radius: 12px;
        }

        .hotbar-slot {
            width: 55px;
            height: 55px;
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            position: relative;
        }

        .hotbar-slot.active {
            border-color: var(--primary);
            box-shadow: 0 0 15px rgba(212,175,55,0.4);
        }

        .hotbar-slot .count {
            position: absolute;
            bottom: 2px;
            right: 4px;
            font-size: 0.7rem;
            font-weight: bold;
        }

        /* Indicador de Intera√ß√£o */
        .interaction-prompt {
            position: absolute;
            top: 60%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--ui-bg);
            padding: 12px 25px;
            border-radius: 25px;
            border: 2px solid var(--primary);
            display: none;
            align-items: center;
            gap: 10px;
            font-size: 0.95rem;
            animation: pulse 2s infinite;
        }

        .interaction-prompt.show {
            display: flex;
        }

        @keyframes pulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.05); }
        }

        /* Di√°logo do Luis */
        .luis-dialogue {
            position: absolute;
            bottom: 150px;
            right: 30px;
            max-width: 400px;
            background: var(--ui-bg);
            border: 2px solid rgba(0,212,255,0.4);
            border-radius: 20px;
            padding: 20px;
            display: none;
        }

        .luis-dialogue.show {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(50px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .luis-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .luis-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4a3728, #2d1f16);
            border: 3px solid var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
        }

        .luis-name {
            font-weight: 700;
            color: var(--primary);
            font-size: 1.1rem;
        }

        .luis-mood {
            font-size: 0.75rem;
            color: #888;
        }

        .luis-text {
            font-size: 0.95rem;
            line-height: 1.6;
            color: #e0e0e0;
        }

        /* Menu de Intera√ß√£o Interior */
        .interior-menu {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 500px;
            background: var(--ui-bg);
            border: 2px solid rgba(212,175,55,0.4);
            border-radius: 20px;
            padding: 30px;
            display: none;
            pointer-events: auto;
        }

        .interior-menu.show {
            display: block;
        }

        .interior-title {
            font-family: 'Cinzel', serif;
            font-size: 1.5rem;
            color: var(--primary);
            text-align: center;
            margin-bottom: 25px;
        }

        .interior-grid {
            display:        }

        .game-title {
            font-family            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 40px rgba(212,175,55,0.4);
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.1rem;
            color: #8b9dc3;
            letter-spacing: 0.3em;
            margin-bottom: 50px;
        }

        .menu-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 90%;
            max-width: 400px;
        }

        .menu-btn {
            background: rgba(212,175,55,0.15);
            border: 2px solid rgba(212,175,55,0.4);
            color: var(--light);
            padding: 18px 30px;
            font-family: 'Cinzel', serif;
            font-size: 1rem;
            letter-spacing: 0.15em;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
        }

        .menu-btn:hover {
            background: rgba(212,175,55,0.3);
            transform: translateX(8px);
        }

        /* HUD Primeira Pessoa */
        .fp-hud {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        /* Crosshair */
        .crosshair {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
        }

        .crosshair::before, .crosshair::after {
            content: '';
            position: absolute;
            background: rgba(255,255,255,0.8);
        }

        .crosshair::before {
            width: 2px;
            height: 20px;
            left: 9px;
            top: 0;
        }

        .crosshair::after {
            width: 20px;
            height: 2px;
            left: 0;
            top: 9px;
        }

        .crosshair-dot {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #ffd700;
            border-radius: 50%;
            top: 8px;
            left: 8px;
        }

        /* Barras de Status */
        .status-bars {
            position: absolute;
            bottom: 30px;
            left: 30px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            background: var(--ui-bg);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .bar-row {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.8rem;
        }

        .bar-icon {
            width: 20px;
            text-align: center;
        }

        .bar-container {
            width: 150px;
            height: 12px;
            background: rgba(0,0,0,0.6);
            border-radius: 6px;
            overflow: hidden;
        }

        .bar-fill {
            height: 100%;
            transition: width 0.3s ease;
            border-radius: 6px;
        }

        .health { background: linear-gradient(90deg, #8b0000, #ff4444); }
        .hunger { background: linear-gradient(90deg, #8b4513, #ff6b35); }
        .thirst { background: linear-gradient(90deg, #0066cc, #4ecdc4); }
        .energy { background: linear-gradient(90deg, #666600, #ffff00); }

        /* Invent√°rio R√°pido */
        .hotbar {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
            background: var(--ui-bg);
            padding: 10px;
            border-radius: 12px;
        }

        .hotbar-slot {
            width: 55px;
            height: 55px;
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            position: relative;
        }

        .hotbar-slot.active {
            border-color: var(--primary);
            box-shadow: 0 0 15px rgba(212,175,55,0.4);
        }

        .hotbar-slot .count {
            position: absolute;
            bottom: 2px;
            right: 4px;
            font-size: 0.7rem;
            font-weight: bold;
        }

        /* Indicador de Intera√ß√£o */
        .interaction-prompt {
            position: absolute;
            top: 60%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--ui-bg);
            padding: 12px 25px;
            border-radius: 25px;
            border: 2px solid var(--primary);
            display: none;
            align-items: center;
            gap: 10px;
            font-size: 0.95rem;
            animation: pulse 2s infinite;
        }

        .interaction-prompt.show {
            display: flex;
        }

        @keyframes pulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.05); }
        }

        /* Di√°logo do Luis */
        .luis-dialogue {
            position: absolute;
            bottom: 150px;
            right: 30px;
            max-width: 400px;
            background: var(--ui-bg);
            border: 2px solid rgba(0,212,255,0.4);
            border-radius: 20px;
            padding: 20px;
            display: none;
        }

        .luis-dialogue.show {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(50px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .luis-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .luis-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4a3728, #2d1f16);
            border: 3px solid var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
        }

        .luis-name {
            font-weight: 700;
            color: var(--primary);
            font-size: 1.1rem;
        }

        .luis-mood {
            font-size: 0.75rem;
            color: #888;
        }

        .luis-text {
            font-size: 0.95rem;
            line-height: 1.6;
            color: #e0e0e0;
        }

        /* Menu de Intera√ß√£o Interior */
        .interior-menu {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 500px;
            background: var(--ui-bg);
            border: 2px solid rgba(212,175,55,0.4);
            border-radius: 20px;
            padding: 30px;
            display: none;
            pointer-events: auto;
        }

        .interior-menu.show {
            display: block;
        }

        .interior-title {
            font-family: 'Cinzel', serif;
            font-size: 1.5rem;
            color: var(--primary);
            text-align: center;
            margin-bottom: 25px;
        }

        .interior-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .interior-action {
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.15);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .interior-action:hover {
            background: rgba(212,175,55,0.15);
            border-color: var(--primary);
            transform: scale(1.02);
        }

        .interior-action .icon {
            font-size: 2.5rem;
            margin-bottom: 8px;
        }

        .interior-action .label {
            font-size: 0.9rem;
            color: #ccc;
        }

        /* Alerta de Desastre */
        .disaster-alert {
            position: absolute;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(90deg, #8b0000, #ff0000);
            padding: 15px 40px;
            border-radius: 10px;
            font-weight: 700;
            font-size: 1.2rem;
            display: none;
            animation: alertPulse 1s infinite;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .disaster-alert.show {
            display: block;
        }

        @keyframes alertPulse {
            0%, 100% { box-shadow: 0 0 20px rgba(255,0,0,0.5); }
            50% { box-shadow: 0 0 40px rgba(255,0,0,0.8); }
        }

        /* Controles, #ff0000);
            padding: 15px 40px;
            border-radius: 10px;
            font-weight: 700;
            font-size: 1.2rem;
            display: none;
            animation: alertPulse 1s infinite;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .disaster-alert.show {
            display: block;
        }

        @keyframes alertPulse {
            0%, 100% { box-shadow: 0 0 20px rgba(255,0,0,0.5); }
            50% { box-shadow: 0 0 40px rgba(255,0,0,0.8); }
        }

        /* Controles Mobile */
        #mobileControls {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 15;
        }

        .look-zone {
            position: absolute;
            top: 0;
            right: 0;
            width: 60%;
            height: 70%;
            pointer-events: auto;
        }

        .move-zone {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 40%;
            height: 40%;
            pointer-events: auto;
        }

        .action-buttons-fp {
            position: absolute;
            bottom: 150px;
            right: 30px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            pointer-events: auto;
        }

        .fp-btn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: rgba(0,0,0,0.7);
            border: 3px solid rgba(255,255,255,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            backdrop-filter: blur(10px);
        }

        .fp-btn:active {
            transform: scale(0.95);
            background: rgba(212,175,55,0.3);
        }

        /* Minimapa */
        .minimap-fp {
            position: absolute;
            top: 30px;
            right: 30px;
            width: Mobile */
        #mobileControls {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 15;
        }

        .look-zone {
            position: absolute;
            top: 0;
            right: 0;
            width: 60%;
            height: 70%;
            pointer-events: auto;
        }

        .move-zone {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 40%;
            height: 40%;
            pointer-events: auto;
        }

        .action-buttons-fp {
            position: absolute;
            bottom: 150px;
            right: 30px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            pointer-events: auto;
        }

        .fp-btn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: rgba(0,0,0,0.7);
            border: 3px solid rgba(255,255,255,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            backdrop-filter: blur(10px);
        }

        .fp-btn:active {
            transform: scale(0.95);
            background: rgba(212,175,55,0.3);
        }

        /* Minimapa */
        .minimap-fp {
            position: absolute;
            top: 30px;
            right: 30px;
            width: 150px;
            height: 150px;
            background: rgba(0,0,0,0.8);
            border: 2px solid rgba(212,175,55,0.4);
            border-radius: 50%;
            overflow: hidden;
        }

        /* Tela de Game Over */
        #gameOverScreen {
            background: rgba(0,0,0,0.95);
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .game-over-title {
            font-family: 'Cinzel', serif;
            font-size: 4rem;
            color: #ff0000;
            margin-bottom: 20px;
            text-shadow: 0 0 30px rgba(255,0,0,0.5);
        }

        .game-over-reason {
            font-size: 1.3rem;
            color: #888;
            margin-bottom: 40px;
        }

        /* Responsivo */
        @media (max-width: 768px) {
            .status-bars { transform: scale(0.85); left: 10px; bottom: 10px; }
            .hotbar { transform: translateX(-50%) scale(0.9); bottom: 10px; }
            .luis-dialogue { max-width: 300px; right: 10px; bottom: 120px; }
        }
    </style>
</head>
<body>

    <!-- Menu Principal -->
    <div id="mainMenu" class="screen active">
        <h1 class="game-title">ECOS DE AETHERION</h1>
        <div class="subtitle">FIRST PERSON EDITION</div>
        <div class="menu-options">
            <button class="menu-btn" onclick="Game.start()">NOVO JOGO</button>
            <button class="menu-btn" onclick="Game.load()">CONTINUAR</button>
            <button class="menu-btn" onclick="Game.showTutorial()">COMO JOGAR</button>
        </div>
    </div>

    <!-- Game Over -->
    <div id="gameOverScreen" class="screen">
        <div class="game-over-title">VOC√ä MORREU</div>
        <div class="game-over-reason" id="deathReason">Fome extrema</div>
        <div class="menu-options" style="max-width: 300px;">
            <button class="menu-btn" onclick="Game.respawn()">TENTAR NOVAMENTE</button>
            <button class="menu-btn" onclick="location.reload()">MENU PRINCIPAL</button>
        </div>
    </div>

    <!-- Canvas do Jogo -->
    <canvas id="gameCanvas"></canvas>

    <!-- UI Layer -->
    <div id="uiLayer">
        <!-- HUD -->
        <div class="fp-hud" id="gameHUD" style="display: none;">
            <div class="crosshair">
                <div class="crosshair-dot"></div>
            </div>

            <div class="disaster-alert" id="disasterAlert">
                ‚ö†Ô∏è TERREMOTO EM ANDAMENTO ‚ö†Ô∏è
            </div>

            <div class="minimap-fp" id="minimap"></div>

            <div class="status-bars">
                <div class="bar-row">
                    <span class="bar-icon">‚ù§Ô∏è</span>
                    <div class="bar-container">
                        <div class="bar-fill health" id="healthBar" style="width: 100%"></div>
                    </div>
                </div>
                <div class="bar-row">
                    <span class="bar-icon">üçñ</span>
                    <div class="bar-container">
                        <div class="bar-fill hunger" id="hungerBar" style="width: 100%"></div>
                    </div>
                </div>
                <div class="bar-row">
                    <span class="bar-icon">üíß</span>
                    <div class="bar-container">
                        <div class="bar-fill thirst" id="thirstBar" style="width: 100%"></div>
                    </div>
                </div>
                <div class="bar-row">
                    <span class="bar-icon">‚ö°</span>
                    <div class="bar-container">
                        <div class="bar-fill energy" id="energyBar" style="width: 100%"></div>
                    </div>
                </div>
            </div>

            <div class="hotbar">
                <div class="hotbar-slot active" data-slot="0">üëä<span class="count"></span></div>
                <div class="hotbar-slot" data-slot="1">üó°Ô∏è<span class="count"></span></div>
                <div class="hotbar-slot" data-slot="2">üçñ<span class="count" id="foodCount">3</span></div>
                <div class="hotbar-slot" data-slot="3">üíß<span class="count" id="waterCount">2</span></div>
                <div class="hotbar-slot" data-slot="4">üî¶<span class="count"></span></div>
            </div>

            <div class="interaction-prompt" id="interactionPrompt">
                <span>üñêÔ∏è</span>
                <span id="interactionText">ENTRAR NA CASA (F)</span>
            </div>
        </div>

        <!-- Di√°logo do Luis -->
        <div class="luis-dialogue" id="luisDialogue">
            <div class="luis-header">
                <div class="luis-avatar">üë®üèΩ‚Äçü¶±</div>
                <div>
                    <div class="luis-name">Luis</div>
                    <div class="luis-mood">Cabelo cacheado ‚Ä¢ √ìculos ‚Ä¢ N√£o cala a boca</div>
                </div>
            </div>
            <div class="luis-text" id="luisText">
                Ei, voc√™ viu isso? Parece que o mundo t√° acabando e eu aqui, preocupado se meu cabelo t√° cacheado o suficiente pra foto do apocalipse...
            </div>
        </div>

        <!-- Menu de Interior -->
        <div class="interior-menu" id="interiorMenu">
            <div class="interior-title" id="interiorTitle">üè† CASA DO ALDE√ÉO</div>
            <div class="interior-grid">
                <div class="interior-action" onclick="Game.interiorAction('eat')">
                    <div class="icon">üçΩÔ∏è</div>
                    <div class="label">Comer</div>
                </div>
                <div class="interior-action" onclick="Game.interiorAction('sleep')">
                    <div class="icon">üõèÔ∏è</div>
                    <div class="label">Dormir</div>
                </div>
                <div class="interior-action" onclick="Game.interiorAction('tv')">
                    <div class="icon">üì∫</div>
                    <div class="label">Assistir TV</div>
                </div>
                <div class="interior-action" onclick="Game.interiorAction('cook')">
                    , #ff0000);
            padding: 15px 40px;
            border-radius: 10px;
            font-weight: 700;
            font-size: 1.2rem;
            display: none;
            animation: alertPulse 1s infinite;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .disaster-alert.show {
            display: block;
        }

        @keyframes alertPulse {
            0%, 100% { box-shadow: 0 0 20px rgba(255,0,0,0.5); }
            50% { box-shadow: 0 0 40px rgba(255,0,0,0.8); }
        }

        /* Controles Mobile */
        #mobileControls {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 15;
        }

        .look-zone {
            position: absolute;
            top: 0;
            right: 0;
            width: 60%;
            height: 70%;
            pointer-events: auto;
        }

        .move-zone {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 40%;
            height: 40%;
            pointer-events: auto;
        }

        .action-buttons-fp {
            position: absolute;
            bottom: 150px;
            right: 30px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            pointer-events: auto;
        }

        .fp-btn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: rgba(0,0,0,0.7);
            border: 3px solid rgba(255,255,255,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            backdrop-filter: blur(10px);
        }

        .fp-btn:active {
            transform: scale(0.95);
            background: rgba(212,175,55,0.3);
        }

        /* Minimapa */
        .minimap-fp {
            position: absolute;
            top: 30px;
            right: 30px;
            width: 150px;
            height: 150px;
            background: rgba(0,0,0,0.8);
            border: 2px solid rgba(212,175,55,0.4);
            border-radius: 50%;
            overflow: hidden;
        }

        /* Tela de Game Over */
        #gameOverScreen {
            background: rgba(0,0,0,0.95);
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .game-over-title {
            font-family: 'Cinzel', serif;
            font-size: 4rem;
            color: #ff0000;
            margin-bottom: 20px;
            text-shadow: 0 0 30px rgba(255,0,0,0.5);
        }

        .game-over-reason {
            font-size: 1.3rem;
            color: #888;
            margin-bottom: 40px;
        }

        /* Responsivo */
        @media (max-width: 768px) {
            .status-bars { transform: scale(0.85); left: 10px; bottom: 10px; }
            .hotbar { transform: translateX(-50%) scale(0.9); bottom: 10px; }
            .luis-dialogue { max-width: 300px; right: 10px; bottom: 120px; }
        }
    </style>
</head>
<body>

    <!-- Menu Principal -->
    <div id="mainMenu" class="screen active">
        <h1 class="game-title">ECOS DE AETHERION</h1>
        <div class="subtitle">FIRST PERSON EDITION</div>
        <div class="menu-options">
            <button class="menu-btn" onclick="Game.start()">NOVO JOGO</button>
            <button class="menu-btn" onclick="Game.load()">CONTINUAR</button>
            <button class="menu-btn" onclick="Game.showTutorial()">COMO JOGAR</button>
        </div>
    </div>

    <!-- Game Over -->
    <div id="gameOverScreen" class="screen">
        <div class="game-over-title">VOC√ä MORREU</div>
        <div class="game-over-reason" id="deathReason">Fome extrema</div>
        <div class="menu-options" style="max-width: 300px;">
            <button class="menu-btn" onclick="Game.respawn()">TENTAR NOVAMENTE</button>
            <button class="menu-btn" onclick="location.reload()">MENU PRINCIPAL</button>
        </div>
    </div>

    <!-- Canvas do Jogo -->
    <canvas id="gameCanvas"></canvas>

    <!-- UI Layer -->
    <div id="uiLayer">
        <!-- HUD -->
        <div class="fp-hud" id="gameHUD" style="display: none;">
            <div class="crosshair">
                <div class="crosshair-dot"></div>
            </div>

            <div class="disaster-alert" id="disasterAlert">
                ‚ö†Ô∏è TERREMOTO EM ANDAMENTO ‚ö†Ô∏è
            </div>

            <div class="minimap-fp" id="minimap"></div>

            <div class="status-bars">
                <div class="bar-row">
                    <span class="bar-icon">‚ù§Ô∏è</span>
                    <div class="bar-container">
                        <div class="bar-fill health" id="healthBar" style="width: 100%"></div>
                    </div>
                </div>
                <div class="bar-row">
                    <span class="bar-icon">üçñ</span>
                    <div class="bar-container">
                        <div class="bar-fill hunger" id="hungerBar" style="width: 100%"></div>
                    </div>
                </div>
                <div class="bar-row">
                    <span class="bar-icon">üíß</span>
                    <div class="bar-container">
                        <div class="bar-fill thirst" id="thirstBar" style="width: 100%"></div>
                    </div>
                </div>
                <div class="bar-row">
                    <span class="bar-icon">‚ö°</span>
                    <div class="bar-container">
                        <div class="bar-fill energy" id="energyBar" style="width: 100%"></div>
                    </div>
                </div>
            </div>

            <div class="hotbar">
                <div class="hotbar-slot active" data-slot="0">üëä<span class="count"></span></div>
                <div class="hotbar-slot" data-slot="1">üó°Ô∏è<span class="count"></span></div>
                <div class="hotbar-slot" data-slot="2">üçñ<span class="count" id="foodCount">3</span></div>
                <div class="hotbar-slot" data-slot="3">üíß<span class="count" id="waterCount">2</span></div>
                <div class="hotbar-slot" data-slot="4">üî¶<span class="count"></span></div>
            </div>

            <div class="interaction-prompt" id="interactionPrompt">
                <span>üñêÔ∏è</span>
                <span id="interactionText">ENTRAR NA CASA (F)</span>
            </div>
        </div>

        <!-- Di√°logo do Luis -->
        <div class="luis-dialogue" id="luisDialogue">
            <div class="luis-header">
                <div class="luis-avatar">üë®üèΩ‚Äçü¶±</div>
                <div>
                    <div class="luis-name">Luis</div>
                    <div class="luis-mood">Cabelo cacheado ‚Ä¢ √ìculos ‚Ä¢ N√£o cala a boca</div>
                </div>
            </div>
            <div class="luis-text" id="luisText">
                Ei, voc√™ viu isso? Parece que o mundo t√° acabando e eu aqui, preocupado se meu cabelo t√° cacheado o suficiente pra foto do apocalipse...
            </div>
        </div>

        <!-- Menu de Interior -->
        <div class="interior-menu" id="interiorMenu">
            <div class="interior-title" id="interiorTitle">üè† CASA DO ALDE√ÉO</div>
            <div class="interior-grid">
                <div class="interior-action" onclick="Game.interiorAction('eat')">
                    <div class="icon">üçΩÔ∏è</div>
                    <div class="label">Comer</div>
                </div>
                <div class="interior-action" onclick="Game.interiorAction('sleep')">
                    <div class="icon">üõèÔ∏è</div>
                    <div class="label">Dormir</div>
                </div>
                <div class="interior-action" onclick="Game.interiorAction('tv')">
                    <div class="icon">üì∫</div>
                    <div class="label">Assistir TV</div>
                </div>
                <div class="interior-action" onclick="Game.interiorAction('cook')">
                    <div class="icon">üë®‚Äçüç≥</div>
                    <div class="label">Cozinhar</div>
                </div>
                <div class="interior-action" onclick="Game.interiorAction('storage')">
                    <div class="icon">üì¶</div>
                    <div class="label">Armazenamento</div>
                </div>
                <div class="interior-action" onclick="Game.interiorAction('exit')">
                    <div class="icon">üö™</div>
                    <div class="label">Sair</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Controles Mobile -->
    <div id="mobileControls" style="display: none;">
        <div class="look-zone" id="lookZone"></div>
        <div class="move-zone" id="moveZone"></div>
        <div class="action-buttons-fp">
            <div class="fp-btn" id="btnInteract" onclick="Game.tryInteract()">üñêÔ∏è</div>
            <div class="fp-btn" id="btnAttack" onclick="Game.attack()">üëä</div>
        </div>
    </div>

    <script>
        // ==================== ENGINE DE RAYCASTING ====================
        const Raycaster = {
            canvas: null,
            ctx: null,
            width: 0,
            height: 0,
            
            // Mapa do mundo (1 = parede, 0 = vazio, 2 = porta, 3 = √°gua, 4 = √°rvore)
            map: [],
            mapSize: 32,
            tileSize: 64,
            
            // Jogador
            player: {
                x: 96,
                y: 96,
                dir: 0, // √Çngulo em radianos
                fov: Math.PI / 3,
                speed: 3,
                rotSpeed: 0.05
            },
            
            // Texturas procedurais
            textures: {},
            
            init() {
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d', { alpha: false });
                this.resize();
                window.addEventListener('resize', () => this.resize());
                
                this.generateMap();
                this.generateTextures();
                
                // Controles de mouse
                this.setupMouseLook();
            },
            
            resize() {
                this.width = window.innerWidth;
                this.height = window.innerHeight;
                this.canvas.width = this.width;
                this.canvas.height = this.height;
            },
            
            generateMap() {
                // Criar mundo procedural
                for (let y = 0; y < this.mapSize; y++) {
                    this.map[y] = [];
                    for (let x = 0; x < this.mapSize; x++) {
                        // Bordas sempre s√£o paredes
                        if (x === 0 || x === this.mapSize - 1 || y === 0 || y === this.mapSize - 1) {
                            this.map[y][x] = 1;
                        } else {
                            // Gerar constru√ß√µes
                            const rand = Math.random();
                            if (rand < 0.1) this.map[y][x] = 1; // Parede aleat√≥ria
                            else if (rand < 0.12) this.map[y][x] = 2; // Porta de casa
                            else if (rand < 0.15) this.map[y][x] = 3; // √Ågua
                            else if (rand < 0.20) this.map[y][x] = 4; // √Årvore
                            else this.map[y][x] = 0; // Vazio
                        }
                    }
                }
                
                // Garantir spawn livre
                this.map[1][1] = 0;
                this.map[1][2] = 0;
                this.map[2][1] = 0;
                this.map[2][2] = 0;
            },
            
            generateTextures() {
                // Criar texturas em canvas
                const createTexture = (color, detail) => {
                    const c = document.createElement('canvas');
                    c.width = 64;
                    c.height = 64;
                    const x = c.getContext('2d');
                    x.fillStyle = color;
                    x.fillRect(0, 0, 64, 64);
                    
                    // Adicionar detalhes
                    x.fillStyle = detail;
                    for (let i = 0; i < 20; i++) {
                        x.fillRect(Math.random() * 60, Math.random() * 60, 4, 4);
                    }
                    return c;
                };
                
                this.textures = {
                    wall: createTexture('#4a4a5a', '#3a3a4a'),
                    door: createTexture('#8b4513', '#654321'),
                    water: createTexture('#4a90e2', '#3a80d2'),
                    tree: createTexture('#2d5a3d', '#1a3d2e'),
                    floor: createTexture('#3d5c48', '#2d4a3e')
                };
            },
            
            castRays() {
                const numRays = this.width / 2; // Resolu√ß√£o horizontal
                const deltaAngle = this.player.fov / numRays;
                
                // Fundo (c√©u e ch√£o)
                const skyGrad = this.ctx.createLinearGradient(0, 0, 0, this.height);
                skyGrad.addColorStop(0, '#87ceeb');
                skyGrad.addColorStop(0.5, '#2d4a3e');
                skyGrad.addColorStop(1, '#1a2f1e');
                this.ctx.fillStyle = skyGrad;
                this.ctx.fillRect(0, 0, this.width, this.height);
                
                // Raycasting principal
                for (let i = 0; i < numRays; i++) {
                    const rayAngle = this.player.dir - this.player.fov / 2 + i * deltaAngle;
                    const dist = this.castSingleRay(rayAngle);
                    
                    // Corrigir distor√ß√£o de peixe
                    const correctedDist = dist * Math.cos(rayAngle - this.player.dir);
                    const wallHeight = (this.tileSize / correctedDist) * 277;
                    
                    // Desenhar parede
                    const x = i * 2;
                    const y = (this.height - wallHeight) / 2;
                    
                    // Sombreamento baseado na dist√¢ncia
                    const brightness = Math.max(0.2, 1 - correctedDist / 800);
                    this.ctx.fillStyle = `rgba(100, 100, 120, ${brightness})`;
                    this.ctx.fillRect(x, y, 2, wallHeight);
                }
            },
            
            castSingleRay(angle) {
                const sin = Math.sin(angle);
                const cos = Math.cos(angle);
                
                let dist = 0;
                const step = 0.5;
                const maxDist = 1000;
                
                while (dist < maxDist) {
                    const x = this.player.x + cos * dist;
                    const y = this.player.y + sin * dist;
                    
                    const mapX = Math.floor(x / this.tileSize);
                    const mapY = Math.floor(y / this.tileSize);
                    
                    if (mapX < 0 || mapX >= this.mapSize || mapY < 0 || mapY >= this.mapSize) {
                        return maxDist;
                    }
                    
                    if (this.map[mapY][mapX] !== 0) {
                        return dist;
                    }
                    
                    dist += step;
                }
                
                return maxDist;
            },
            
            movePlayer(dx, dy) {
                const newX = this.player.x + dx;
                const newY = this.player.y + dy;
                
                const mapX = Math.floor(newX / this.tileSize);
                const mapY = Math.floor(newY / this.tileSize);
                
                // Colis√£o
                if (this.map[mapY] && this.map[mapY][mapX] === 0) {
                    this.player.x = newX;
                    this.player.y = newY;
                }
            },
            
            rotatePlayer(angle) {
                this.player.dir += angle;
            },
            
            setupMouseLook() {
                let isDragging = false;
                let lastX = 0;
                
                document.addEventListener('mousedown', (e) => {
                    if (Game.state === 'playing') {
                        isDragging = true;
                        lastX = e.clientX;
                    }
                });
                
                document.addEventListener('mousemove', (e) => {
                    if (isDragging && Game.state === 'playing') {
                        const deltaX = e.clientX - lastX;
                        this.rotatePlayer(deltaX * 0.003);
                        lastX = e.clientX;
                    }
                });
                
                document.addEventListener('mouseup', () => {
                    isDragging = false;
                });
                
                // Touch para mobile
                const lookZone = document.getElementById('lookZone');
                lookZone.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                    const touch = e.touches[0];
                    if (lastX !== 0) {
                        const deltaX = touch.clientX - lastX;
                        this.rotatePlayer(deltaX * 0.005);
                    }
                    lastX = touch.clientX;
                }, {passive: false});
                
                lookZone.addEventListener('touchend', () => {
                    lastX = 0;
                });
            },
            
            getPlayerTile() {
                return {
                    x: Math.floor(this.player.x / this.tileSize),
                    y: Math.floor(this.player.y / this.tileSize)
                };
            },
            
            checkInteraction() {
                // Verificar se h√° algo interativo √† frente
                const reach = 80;
                const checkX = this.player.x + Math.cos(this.player.dir) * reach;
                const checkY = this.player.y + Math.sin(this.player.dir) * reach;
                
                const tileX = Math.floor(checkX / this.tileSize);
                const tileY = Math.floor(checkY / this.tileSize);
                
                if (tileX >= 0 && tileX < this.mapSize && tileY >= 0 && tileY < this.mapSize) {
                    const tile = this.map[tileY][tileX];
                    
                    if (tile === 2) return { type: 'door', x: tileX, y: tileY };
                    if (tile === 3) return { type: 'water' };
                    if (tile === 4) return { type: 'tree' };
                }
                
                return null;
            }
        };

        // ==================== PERSONALIDADE DO LUIS ====================
        const LuisAI = {
            dialogues: [
                "Ei, voc√™ viu isso? Parece que o mundo t√° acabando e eu aqui, preocupado se meu cabelo t√° cacheado o suficiente pra foto do apocalipse...",
                "Sabe o que eu tava pensando? A gente t√° correndo de monstros, morrendo de fome, e eu ainda t√¥ usando √≥culos. Prioridades, n√©?",
                "Olha, eu sei que a gente t√° em uma situa√ß√£o de vida ou morte aqui, mas... voc√™ acha que esse lugar tem Wi-Fi?",
                "Meu terapeuta disse que eu deveria 'enfrentar meus medos'. Ent√£o aqui estou eu, enfrentando um apocalipse m√°gico com fome. Progresso!",
                "Cara, eu sou t√£o emocionalmente dispon√≠vel que at√© os monstros est√£o come√ßando a desabafar comigo. 'Luis, minha m√£e nunca me entendeu...'",
                "Voc√™ sabe o que √© engra√ßado? Eu vim pra c√° querendo construir um imp√©rio, fazer dinheiro, ser algu√©m... e agora eu s√≥ quero um prato de comida quente e algu√©m que me entenda.",
                "Eu zoando em assunto s√©rio √© meu mecanismo de defesa, t√° ligado? Se eu parar de fazer piada, eu vou ter que sentir as coisas. E sentir as coisas √© overrated.",
                "Olha essa casa! D√° pra sentar, comer, dormir... quase me faz esquecer que tem um lorde das trevas querendo destruir a realidade. Quase.",
                "Sabe o que eu aprendi? Que voc√™ pode ser o cara mais determinado do mundo, com mil planos, mas √†s vezes... √†s vezes voc√™ s√≥ precisa de algu√©m do seu lado que aguente seu jeito impulsivo.",
                "Eu sou perfeccionista, trabalhador, criativo... e completamente perdido quando o assunto √© lidar com sentimentos. Quer trocar? Voc√™ fica com os sentimentos, eu fico com seu mapa."
            ],
            
            seriousDialogues: [
                "Olha... eu sei que eu fico zuando, mas quando o assunto √© s√©rio, eu fico s√©rio. E agora √© s√©rio. A gente precisa de um plano.",
                "Eu posso ser impulsivo, mas eu n√£o sou burro. Isso aqui √© maior que a gente. E eu... eu n√£o quero ver voc√™ morrer, t√°?",
                "Voc√™ me conhece. Sabe que eu brinco, que eu zo. Mas saiba que quando voc√™ precisar, eu t√¥ aqui. Firme. √â s√≥ chamar."
            ],
            
            disasterDialogues: [
                "OK, OK, terremoto! Eu sei que eu disse que queria emo√ß√£o na vida, mas isso aqui t√° tipo Netflix demais!",
                "CUIDADO![mapY][mapX] === 0) {
                    this.player.x = newX;
                    this.player.y = newY;
                }
            },
            
            rotatePlayer(angle) {
                this.player.dir += angle;
            },
            
            setupMouseLook() {
                let isDragging = false;
                let lastX = 0;
                
                document.addEventListener('mousedown', (e) => {
                    if (Game.state === 'playing') {
                        isDragging = true;
                        lastX = e.clientX;
                    }
                });
                
                document.addEventListener('mousemove', (e) => {
                    if (isDragging && Game.state === 'playing') {
                        const deltaX = e.clientX - lastX;
                        this.rotatePlayer(deltaX * 0.003);
                        lastX = e.clientX;
                    }
                });
                
                document.addEventListener('mouseup', () => {
                    isDragging = false;
                });
                
                // Touch para mobile
                const lookZone = document.getElementById('lookZone');
                lookZone.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                    const touch = e.touches[0];
                    if (lastX !== 0) {
                        const deltaX = touch.clientX - lastX;
                        this.rotatePlayer(deltaX * 0.005);
                    }
                    lastX = touch.clientX;
                }, {passive: false});
                
                lookZone.addEventListener('touchend', () => {
                    lastX = 0;
                });
            },
            
            getPlayerTile() {
                return {
                    x: Math.floor(this.player.x / this.tileSize),
                    y: Math.floor(this.player.y / this.tileSize)
                };
            },
            
            checkInteraction() {
                // Verificar se h√° algo interativo √† frente
                const reach = 80;
                const checkX = this.player.x + Math.cos(this.player.dir) * reach;
                const checkY = this.player.y + Math.sin(this.player.dir) * reach;
                
                const tileX = Math.floor(checkX / this.tileSize);
                const tileY = Math.floor(checkY / this.tileSize);
                
                if (tileX >= 0 && tileX < this.mapSize && tileY >= 0 && tileY < this.mapSize) {
                    const tile = this.map[tileY][tileX];
                    
                    if (tile === 2) return { type: 'door', x: tileX, y: tileY };
                    if (tile === 3) return { type: 'water' };
                    if (tile === 4) return { type: 'tree' };
                }
                
                return null;
            }
        };

        // ==================== PERSONALIDADE DO LUIS ====================
        const LuisAI = {
            dialogues: [
                "Ei, voc√™ viu isso? Parece que o mundo t√° acabando e eu aqui, preocupado se meu cabelo t√° cacheado o suficiente pra foto do apocalipse...",
                "Sabe o que eu tava pensando? A gente t√° correndo de monstros, morrendo de fome, e eu ainda t√¥ usando √≥culos. Prioridades, n√©?",
                "Olha, eu sei que a gente t√° em uma situa√ß√£o de vida ou morte aqui, mas... voc√™ acha que esse lugar tem Wi-Fi?",
                "Meu terapeuta disse que eu deveria 'enfrentar meus medos'. Ent√£o aqui estou eu, enfrentando um apocalipse m√°gico com fome. Progresso!",
                "Cara, eu sou t√£o emocionalmente dispon√≠vel que at√© os monstros est√£o come√ßando a desabafar comigo. 'Luis, minha m√£e nunca me entendeu...'",
                "Voc√™ sabe o que √© engra√ßado? Eu vim pra c√° querendo construir um imp√©rio, fazer dinheiro, ser algu√©m... e agora eu s√≥ quero um prato de comida quente e algu√©m que me entenda.",
                "Eu zoando em assunto s√©rio √© meu mecanismo de defesa, t√° ligado? Se eu parar de fazer piada, eu vou ter que sentir as coisas. E sentir as coisas √© overrated.",
                "Olha essa casa! D√° pra sentar, comer, dormir... quase me faz esquecer que tem um lorde das trevas querendo destruir a realidade. Quase.",
                "Sabe o que eu aprendi? Que voc√™ pode ser o cara mais determinado do mundo, com mil planos, mas √†s vezes... √†s vezes voc√™ s√≥ precisa de algu√©m do seu lado que aguente seu jeito impulsivo.",
                "Eu sou perfeccionista, trabalhador, criativo... e completamente perdido quando o assunto √© lidar com sentimentos. Quer trocar? Voc√™ fica com os sentimentos, eu fico com seu mapa."
            ],
            
            seriousDialogues: [
                "Olha... eu sei que eu fico zuando, mas quando o assunto √© s√©rio, eu fico s√©rio. E agora √© s√©rio. A gente precisa de um plano.",
                "Eu posso ser impulsivo, mas eu n√£o sou burro. Isso aqui √© maior que a gente. E eu... eu n√£o quero ver voc√™ morrer, t√°?",
                "Voc√™ me conhece. Sabe que eu brinco, que eu zo. Mas saiba que quando voc√™ precisar, eu t√¥ aqui. Firme. √â s√≥ chamar."
            ],
            
            disasterDialogues: [
                "OK, OK, terremoto! Eu sei que eu disse que queria emo√ß√£o na vida, mas isso aqui t√° tipo Netflix demais!",
                "CUIDADO! E eu aqui preocupado se meu √≥culos vai cair... PRIORIDADES, LUIS!",
                " corre! E olha, se eu morrer, diz pra minha m√£e que eu... que eu devia ter ouvido ela sobre a faculdade!"
            ],
            
            currentDialogue: 0,
            isSerious: false,
            
            speak(type = 'normal') {
                const dialogue = document.getElementById('luisDialogue');
                const text = document.getElementById('luisText');
                
                let pool = this.dialogues;
                if (type === 'serious') pool = this.seriousDialogues;
                if (type === 'disaster') pool = this.disasterDialogues;
                
                const msg = pool[Math.floor(Math.random() * pool.length)];
                text.textContent = msg;
                
                dialogue.classList.add('show');
                
                // Esconder ap√≥s 6 segundos
                setTimeout(() => {
                    dialogue.classList.remove('show');
                }, 6000);
            },
            
            update() {
                // Falar aleatoriamente a cada 20-40 segundos
                if (Math.random() < 0.001) {
                    this.speak();
                }
            }
        };

        // ==================== SISTEMA DE CASAS INTERATIVAS ====================
        const HouseSystem = {
            currentHouse: null,
            isInside: false,
            
            houses: {
                villager: {
                    name: "Casa do Alde√£o",
                    rooms: ['sala', 'cozinha', 'quarto'],
                    items: ['p√£o', '√°gua', 'tocha'],
                    hasTV: true,
                    bed: true
                },
                rich: {
                    name: "Mans√£o",
                    rooms: ['sala', 'cozinha', 'quarto', 'escrit√≥rio', 'adega'],
                    items: ['carne', 'vinho', 'joia', 'livro'],
                    hasTV: true,
                    bed: true
                },
                abandoned: {
                    name: "Cabana Abandonada",
                    rooms: ['quarto'],
                    items: ['mofo', 'rato'],
                    hasTV: false,
                    bed: false
                }
            },
            
            enter(type) {
                this.currentHouse = this.houses[type] || this.houses.villager;
                this.isInside = true;
                
                document.getElementById('interiorTitle').textContent = `üè† ${this.currentHouse.name.toUpperCase()}`;
                document.getElementById('interiorMenu').classList.add('show');
                
                Game.state = 'interior';
                LuisAI.speak('normal');
            },
            
            exit() {
                this.isInside = false;
                this.currentHouse = null;
                document.getElementById('interiorMenu').classList.remove('show');
                Game.state = 'playing';
            },
            
            action(action) {
                const house = this.currentHouse;
                const p = Game.player;
                
                switch(action) {
                    case 'eat':
                        if (p.hunger >= 100) {
                            LuisAI.speak('normal');
                            return;
                        }
                        p.hunger = Math.min(100, p.hunger + 40);
                        p.hp = Math.min(p.maxHp, p.hp + 15);
                        UI.notify("üçΩÔ∏è Voc√™ comeu uma refei√ß√£o caseira!");
                        LuisAI.speak("Nada como comida de casa... mesmo que a casa n√£o seja minha!");
                        break;
                        
                    case 'sleep':
                        if (!house.bed) {
                            UI.notify("‚ùå N√£o h√° cama aqui!");
                            return;
                        }
                        p.energy = 100;
                        p.hp = p.maxHp;
                        // Passar tempo
                        Game.time += 8;
                        UI.notify("üò¥ Voc√™ dormiu 8 horas. Energia restaurada!");
                        LuisAI.speak("Eu tamb√©m queria dormir, mas meu c√©rebro decide revisar todas as vergonhas da minha vida √†s 3 da manh√£.");
                        break;
                        
                    case 'tv':
                        if (!house.hasTV) {
                            UI.notify("‚ùå N√£o h√° TV aqui!");
                            return;
                        }
                        UI.notify("üì∫ Voc√™ assistiu as not√≠cias. O mundo est√° em caos.");
                        p.energy -= 5;
                        LuisAI.speak("Not√≠cias: 'Mordrath destr√≥i vilas'. Eu: 'Mas e o tr√¢nsito?'");
                        break;
                        
                    case 'cook':
                        if (p.inventory.meat > 0) {
                            p.inventory.meat--;
                            p.inventory.cookedMeat = (p.inventory.cookedMeat || 0) + 2;
                            UI.notify("üë®‚Äçüç≥ Voc√™ cozinhou carne!");
                            LuisAI.speak("Eu cozinhando: parece seguro. Eu comendo: espero que esteja cozido. Minha barriga depois: N√ÉO ESTAVA.");
                        } else {
                            UI.notify("‚ùå Voc√™ precisa de carne crua!");
                        }
                        break;
                        
                    case 'storage':
                        UI.notify("üì¶ Voc√™ olhou no armazenamento.");
                        LuisAI.speak("Eu abrindo arm√°rio alheio: 'Opa, isso √© invas√£o de privacidade?' Eu tamb√©m: 'Mas tem biscoito...'");
                        break;
                        
                    case 'exit':
                        this.exit();
                        break;
                }
                
                UI.updateStats();
            }
        };

        // ==================== DESASTRES NATURAIS ====================
        const DisasterSystem = {
            active: false,
            type: null,
            duration: 0,
            intensity: 0,
            
            types: {
                earthquake: {
                    name: "TERREMOTO",
                    duration: 300, // 5 segundos em frames
                    damage: 5,
                    shake: true
                },
                storm: {
                    name: "TEMPESTADE M√ÅGICA",
                    duration: 600,
                    damage: 3,
                    lightning: true
                },
                fire: {
                    name: "INC√äNDIO",
                    duration: 450,
                    damage: 8,
                    spread: true
                }
            },
            
            trigger(type) {
                if (this.active) return;
                
                this.active = true;
                this.type = this.types[type];
                this.duration = this.type.duration;
                this.intensity = 1;
                
                // Mostrar alerta
                const alert = document.getElementById('disasterAlert');
                alert.textContent = `‚ö†Ô∏è ${this.type.name} EM ANDAMENTO ‚ö†Ô∏è`;
                alert.classList.add('show');
                
                // Luis comenta
                LuisAI.speak('disaster');
                
                // Som de alerta
                this.playAlertSound();
            },
            
            update() {
                if (!this.active) {
                    // Chance aleat√≥ria de desastre (0.01% por frame)
                    if (Math.random() < 0.0001) {
                        const types = ['earthquake', 'storm', 'fire'];
                        this.trigger(types[Math.floor(Math.random() * types.length)]);
                    }
                    return;
                }
                
                this.duration--;
                
                // Efeitos
                if (this.type.shake) {
                    Raycaster.player.x += (Math.random() - 0.5) * this.intensity * 3;
                    Raycaster.player.y += (Math.random() - 0.5) * this.intensity * 3;
                }
                
                // Dano ao jogador
                if (this.duration % 60 === 0) { // A cada segundo
                    Game.player.hp -= this.type.damage;
                    UI.updateStats();
                    
                    if (Game.player.hp <= 0) {
                        Game.gameOver(`Morto por ${this.type.name}`);
                    }
                }
                
                // Fim do desastre
                if (this.duration <= 0) {
                    this.end();
                }
            },
            
            endY][mapX] === 0) {
                    this.player.x = newX;
                    this.player.y = newY;
                }
            },
            
            rotatePlayer(angle) {
                this.player.dir += angle;
            },
            
            setupMouseLook() {
                let isDragging = false;
                let lastX = 0;
                
                document.addEventListener('mousedown', (e) => {
                    if (Game.state === 'playing') {
                        isDragging = true;
                        lastX = e.clientX;
                    }
                });
                
                document.addEventListener('mousemove', (e) => {
                    if (isDragging && Game.state === 'playing') {
                        const deltaX = e.clientX - lastX;
                        this.rotatePlayer(deltaX * 0.003);
                        lastX = e.clientX;
                    }
                });
                
                document.addEventListener('mouseup', () => {
                    isDragging = false;
                });
                
                // Touch para mobile
                const lookZone = document.getElementById('lookZone');
                lookZone.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                    const touch = e.touches[0];
                    if (lastX !== 0) {
                        const deltaX = touch.clientX - lastX;
                        this.rotatePlayer(deltaX * 0.005);
                    }
                    lastX = touch.clientX;
                }, {passive: false});
                
                lookZone.addEventListener('touchend', () => {
                    lastX = 0;
                });
            },
            
            getPlayerTile() {
                return {
                    x: Math.floor(this.player.x / this.tileSize),
                    y: Math.floor(this.player.y / this.tileSize)
                };
            },
            
            checkInteraction() {
                // Verificar se h√° algo interativo √† frente
                const reach = 80;
                const checkX = this.player.x + Math.cos(this.player.dir) * reach;
                const checkY = this.player.y + Math.sin(this.player.dir) * reach;
                
                const tileX = Math.floor(checkX / this.tileSize);
                const tileY = Math.floor(checkY / this.tileSize);
                
                if (tileX >= 0 && tileX < this.mapSize && tileY >= 0 && tileY < this.mapSize) {
                    const tile = this.map[tileY][tileX];
                    
                    if (tile === 2) return { type: 'door', x: tileX, y: tileY };
                    if (tile === 3) return { type: 'water' };
                    if (tile === 4) return { type: 'tree' };
                }
                
                return null;
            }
        };

        // ==================== PERSONALIDADE DO LUIS ====================
        const LuisAI = {
            dialogues: [
                "Ei, voc√™ viu isso? Parece que o mundo t√° acabando e eu aqui, preocupado se meu cabelo t√° cacheado o suficiente pra foto do apocalipse...",
                "Sabe o que eu tava pensando? A gente t√° correndo de monstros, morrendo de fome, e eu ainda t√¥ usando √≥culos. Prioridades, n√©?",
                "Olha, eu sei que a gente t√° em uma situa√ß√£o de vida ou morte aqui, mas... voc√™ acha que esse lugar tem Wi-Fi?",
                "Meu terapeuta disse que eu deveria 'enfrentar meus medos'. Ent√£o aqui estou eu, enfrentando um apocalipse m√°gico com fome. Progresso!",
                "Cara, eu sou t√£o emocionalmente dispon√≠vel que at√© os monstros est√£o come√ßando a desabafar comigo. 'Luis, minha m√£e nunca me entendeu...'",
                "Voc√™ sabe o que √© engra√ßado? Eu vim pra c√° querendo construir um imp√©rio, fazer dinheiro, ser algu√©m... e agora eu s√≥ quero um prato de comida quente e algu√©m que me entenda.",
                "Eu zoando em assunto s√©rio √© meu mecanismo de defesa, t√° ligado? Se eu parar de fazer piada, eu vou ter que sentir as coisas. E sentir as coisas √© overrated.",
                "Olha essa casa! D√° pra sentar, comer, dormir... quase me faz esquecer que tem um lorde das trevas querendo destruir a realidade. Quase.",
                "Sabe o que eu aprendi? Que voc√™ pode ser o cara mais determinado do mundo, com mil planos, mas √†s vezes... √†s vezes voc√™ s√≥ precisa de algu√©m do seu lado que aguente seu jeito impulsivo.",
                "Eu sou perfeccionista, trabalhador, criativo... e completamente perdido quando o assunto √© lidar com sentimentos. Quer trocar? Voc√™ fica com os sentimentos, eu fico com seu mapa."
            ],
            
            seriousDialogues: [
                "Olha... eu sei que eu fico zuando, mas quando o assunto √© s√©rio, eu fico s√©rio. E agora √© s√©rio. A gente precisa de um plano.",
                "Eu posso ser impulsivo, mas eu n√£o sou burro. Isso aqui √© maior que a gente. E eu... eu n√£o quero ver voc√™ morrer, t√°?",
                "Voc√™ me conhece. Sabe que eu brinco, que eu zo. Mas saiba que quando voc√™ precisar, eu t√¥ aqui. Firme. √â s√≥ chamar."
            ],
            
            disasterDialogues: [
                "OK, OK, terremoto! Eu sei que eu disse que queria emo√ß√£o na vida, mas isso aqui t√° tipo Netflix demais!",
                "CUIDADO! E eu aqui preocupado se meu √≥culos vai cair... PRIORIDADES, LUIS!",
                " corre! E olha, se eu morrer, diz pra minha m√£e que eu... que eu devia ter ouvido ela sobre a faculdade!"
            ],
            
            currentDialogue: 0,
            isSerious: false,
            
            speak(type = 'normal') {
                const dialogue = document.getElementById('luisDialogue');
                const text = document.getElementById('luisText');
                
                let pool = this.dialogues;
                if (type === 'serious') pool = this.seriousDialogues;
                if (type === 'disaster') pool = this.disasterDialogues;
                
                const msg = pool[Math.floor(Math.random() * pool.length)];
                text.textContent = msg;
                
                dialogue.classList.add('show');
                
                // Esconder ap√≥s 6 segundos
                setTimeout(() => {
                    dialogue.classList.remove('show');
                }, 6000);
            },
            
            update() {
                // Falar aleatoriamente a cada 20-40 segundos
                if (Math.random() < 0.001) {
                    this.speak();
                }
            }
        };

        // ==================== SISTEMA DE CASAS INTERATIVAS ====================
        const HouseSystem = {
            currentHouse: null,
            isInside: false,
            
            houses: {
                villager: {
                    name: "Casa do Alde√£o",
                    rooms: ['sala', 'cozinha', 'quarto'],
                    items: ['p√£o', '√°gua', 'tocha'],
                    hasTV: true,
                    bed: true
                },
                rich: {
                    name: "Mans√£o",
                    rooms: ['sala', 'cozinha', 'quarto', 'escrit√≥rio', 'adega'],
                    items: ['carne', 'vinho', 'joia', 'livro'],
                    hasTV: true,
                    bed: true
                },
                abandoned: {
                    name: "Cabana Abandonada",
                    rooms: ['quarto'],
                    items: ['mofo', 'rato'],
                    hasTV: false,
                    bed: false
                }
            },
            
            enter(type) {
                this.currentHouse = this.houses[type] || this.houses.villager;
                this.isInside = true;
                
                document.getElementById('interiorTitle').textContent = `üè† ${this.currentHouse.name.toUpperCase()}`;
                document.getElementById('interiorMenu').classList.add('show');
                
                Game.state = 'interior';
                LuisAI.speak('normal');
            },
            
            exit() {
                this.isInside = false;
                this.currentHouse = null;
                document.getElementById('interiorMenu').classList.remove('show');
                Game.state = 'playing';
            },
            
            action(action) {
                const house = this.currentHouse;
                const p = Game.player;
                
                switch(action) {
                    case 'eat':
                        if (p.hunger >= 100) {
                            LuisAI.speak('normal');
                            return;
                        }
                        p.hunger = Math.min(100, p.hunger + 40);
                        p.hp = Math.min(p.maxHp, p.hp + 15);
                        UI.notify("üçΩÔ∏è Voc√™ comeu uma refei√ß√£o caseira!");
                        LuisAI.speak("Nada como comida de casa... mesmo que a casa n√£o seja minha!");
                        break;
                        
                    case 'sleep':
                        if (!house.bed) {
                            UI.notify("‚ùå N√£o h√° cama aqui!");
                            return;
                        }
                        p.energy = 100;
                        p.hp = p.maxHp;
                        // Passar tempo
                        Game.time += 8;
                        UI.notify("üò¥ Voc√™ dormiu 8 horas. Energia restaurada!");
                        LuisAI.speak("Eu tamb√©m queria dormir, mas meu c√©rebro decide revisar todas as vergonhas da minha vida √†s 3 da manh√£.");
                        break;
                        
                    case 'tv':
                        if (!house.hasTV) {
                            UI.notify("‚ùå N√£o h√° TV aqui!");
                            return;
                        }
                        UI.notify("üì∫ Voc√™ assistiu as not√≠cias. O mundo est√° em caos.");
                        p.energy -= 5;
                        LuisAI.speak("Not√≠cias: 'Mordrath destr√≥i vilas'. Eu: 'Mas e o tr√¢nsito?'");
                        break;
                        
                    case 'cook':
                        if (p.inventory.meat > 0) {
                            p.inventory.meat--;
                            p.inventory.cookedMeat = (p.inventory.cookedMeat || 0) + 2;
                            UI.notify("üë®‚Äçüç≥ Voc√™ cozinhou carne!");
                            LuisAI.speak("Eu cozinhando: parece seguro. Eu comendo: espero que esteja cozido. Minha barriga depois: N√ÉO ESTAVA.");
                        } else {
                            UI.notify("‚ùå Voc√™ precisa de carne crua!");
                        }
                        break;
                        
                    case 'storage':
                        UI.notify("üì¶ Voc√™ olhou no armazenamento.");
                        LuisAI.speak("Eu abrindo arm√°rio alheio: 'Opa, isso √© invas√£o de privacidade?' Eu tamb√©m: 'Mas tem biscoito...'");
                        break;
                        
                    case 'exit':
                        this.exit();
                        break;
                }
                
                UI.updateStats();
            }
        };

        // ==================== DESASTRES NATURAIS ====================
        const DisasterSystem = {
            active: false,
            type: null,
            duration: 0,
            intensity: 0,
            
            types: {
                earthquake: {
                    name: "TERREMOTO",
                    duration: 300, // 5 segundos em frames
                    damage: 5,
                    shake: true
                },
                storm: {
                    name: "TEMPESTADE M√ÅGICA",
                    duration: 600,
                    damage: 3,
                    lightning: true
                },
                fire: {
                    name: "INC√äNDIO",
                    duration: 450,
                    damage: 8,
                    spread: true
                }
            },
            
            trigger(type) {
                if (this.active) return;
                
                this.active = true;
                this.type = this.types[type];
                this.duration = this.type.duration;
                this.intensity = 1;
                
                // Mostrar alerta
                const alert = document.getElementById('disasterAlert');
                alert.textContent = `‚ö†Ô∏è ${this.type.name} EM ANDAMENTO ‚ö†Ô∏è`;
                alert.classList.add('show');
                
                // Luis comenta
                LuisAI.speak('disaster');
                
                // Som de alerta
                this.playAlertSound();
            },
            
            update() {
                if (!this.active) {
                    // Chance aleat√≥ria de desastre (0.01% por frame)
                    if (Math.random() < 0.0001) {
                        const types = ['earthquake', 'storm', 'fire'];
                        this.trigger(types[Math.floor(Math.random() * types.length)]);
                    }
                    return;
                }
                
                this.duration--;
                
                // Efeitos
                if (this.type.shake) {
                    Raycaster.player.x += (Math.random() - 0.5) * this.intensity * 3;
                    Raycaster.player.y += (Math.random() - 0.5) * this.intensity * 3;
                }
                
                // Dano ao jogador
                if (this.duration % 60 === 0) { // A cada segundo
                    Game.player.hp -= this.type.damage;
                    UI.updateStats();
                    
                    if (Game.player.hp <= 0) {
                        Game.gameOver(`Morto por ${this.type.name}`);
                    }
                }
                
                // Fim do desastre
                if (this.duration <= 0) {
                    this.end();
                }
            },
            
            end() {
                this.active = false;
                document.getElementById('disasterAlert').classList.remove('show');
                UI.notify("‚úÖ O desastre passou!");
                LuisAI.speak("Sobrevivemos! Eu t√¥ t√£o emocionado que quase chorei. Quase. Meu √≥culos emba√ßou, s√≥ isso.");
            },
            
            playAlertSound() {
                // Som procedural de alerta
                const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioCtx.createOscillator();
                const gainNode = audioCtx.createGain();
                
                oscillator.type = 'sawtooth';
                oscillator.frequency.setValueAtTime(440, audioCtx.currentTime);
                oscillator.frequency.linearRampToValueAtTime(880, audioCtx.currentTime + 0.1);
                oscillator.frequency.linearRampToValueAtTime(440, audioCtx.currentTime + 0.2);
                
                gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                
                oscillator.connect(gainNode);
                gainNode.connect(audioCtx.destination);
                oscillator.start();
                oscillator.stop(audioCtx.currentTime + 0.5);
            }
        };

        // ==================== UI SYSTEM ====================
        const UI = {
            notify(text) {
                // Criar notifica√ß√£o tempor√°ria
                const div = document.createElement('div');
                div.style.cssText = `
                    position: fixed;
                    top: 100px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: rgba(0,0,0,0.9);
                    border: 1px solid #d4af37;
                    padding: 15px 30px;
                    border-radius: 10px;
                    color: white;
                    z-index: 100;
                    animation: fadeInOut 3s ease forwards;
                `;
                div.textContent = text;
                document.body.appendChild(div);
                setTimeout(() => div.remove(), 3000);
            },
            
            updateStats() {
                const p = Game.player;
                document.getElementById('healthBar').style.width = `${(p.hp/p.maxHp)*100}%`;
                document.getElementById('hungerBar').style.width = `${(p.hunger/100)*100}%`;
                document.getElementById('thirstBar').style.width = `${(p.thirst/100)*100}%`;
                document.getElementById('energyBar').style.width = `${(p.energy/100)*100}%`;
                document.getElementById('foodCount').textContent = p.inventory.cookedMeat || 0;
                document.getElementById('waterCount').textContent = p.inventory.water || 0;
            },
            
            showInteraction(text) {
                const prompt = document.getElementById('interactionPrompt');
                document.getElementById('interactionText').textContent = text;
                prompt.classList.add('show');
            },
            
            hideInteraction() {
                document.getElementById('interactionPrompt').classList.remove('show');
            }
        };

        // ==================== GAME CONTROLLER ====================
        const Game = {
            state: 'menu',
            player: null,
            time: 12, // Hora do dia (0-24)
            
            init() {
                Raycaster.init();
                this.setupControls();
                
                // Loop principal
                requestAnimationFrame(() => this.loop());
            },
            
            setupControls() {
                // Teclado
                window.addEventListener('keydown', (e) => {
                    if (this.state !== 'playing') return;
                    
                    switch(e.code) {
                        case 'KeyW':
                        case 'ArrowUp':
                            this.moveForward();
                            break;
                        case 'KeyS':
                        case 'ArrowDown':
                            this.moveBackward();
                            break;
                        case 'KeyA':
                            this.moveLeft();
                            break;
                        case 'KeyD':
                            this.moveRight();
                            break;
                        case 'KeyF':
                        case 'Enter':
                            this.tryInteract();
                            break;
                        case 'Space':
                            this.attack();
                            break;
                        case 'Escape':
                            this.togglePause();
                            break;
                    }
                });
                
                // Mobile
                const moveZone = document.getElementById('moveZone');
                let touchStart = { x: 0, y: 0 };
                
                moveZone.addEventListener('touchstart', (e) => {
                    touchStart.x = e.touches[0].clientX;
                    touchStart.y = e.touches[0].clientY;
                }, {passive: false});
                
                moveZone.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                    const dx = e.touches[0].clientX - touchStart.x;
                    const dy = e.touches[0].clientY - touchStart.y;
                    
                    if (Math.abs(dy) > Math.abs(dx)) {
                        if (dy < -20) this.moveForward();
                        if (dy > 20) this.moveBackward();
                    } else {
                        if (dx < -20) this.moveLeft();
                        if (dx > 20) this.moveRight();
                    }
                }, {passive: false});
            },
            
            loop() {
                if (this.state === 'playing') {
                    // Renderizar mundo 3D
                    Raycaster.castRays();
                    
                    // Atualizar sistemas
                    this.updatePlayer();
                    DisasterSystem.update();
                    LuisAI.update();
                    this.checkInteractions();
                    
                    // Atualizar survival
                    this.updateSurvival();
                }
                
                requestAnimationFrame(() => this.loop());
            },
            
            updatePlayer() {
                const p = this.player;
                
                // Regenera√ß√£o natural
                if (p.hunger > 80 && p.thirst > 80 && p.energy > 50) {
                    p.hp = Math.min(p.maxHp, p.hp + 0.02);
                }
                
                // Limites
                if (p.hp <= 0) this.gameOver('Vida esgotada');
                if (p.hunger <= 0) {
                    p.hp -= 0.1;
                    if (Math.random() < 0.01) UI.notify("‚ö†Ô∏è Voc√™ est√° morrendo de fome!");
                }
                if (p.thirst <= 0) {
                    p.hp -= 0.15;
                    if (Math.random() < 0.01) UI.notify("‚ö†Ô∏è Voc√™ est√° desidratado!");
                }
                
                UI.updateStats();
            },
            
            updateSurvival() {
                const p = this.player;
                
                // Diminuir necessidades
                p.hunger -= 0.03;
                p.thirst -= 0.05;
                p.energy -= 0.01;
                
                // Limitar
                p.hunger = Math.max(0, Math.min(100, p.hunger));
                p.thirst = Math.max(0, Math.min(100, p.thirst));
                p.energy = Math.max(0, Math.min(100, p.energy));
            },
            
            checkInteractions() {
                const interact = Raycaster.checkInteraction();
                
                if (interact) {
                    if (interact.type === 'door') {
                        UI.showInteraction('ENTRAR NA CASA (F)');
                        this.nearDoor = interact;
                    } else if (interact.type === 'water') {
                        UI.showInteraction('BEBER √ÅGUA (F)');
                    } else if (interact.type === 'tree') {
                        UI.showInteraction('COLETAR MADEIRA (F)');
                    }
                } else {
                    UI.hideInteraction();
                    this.nearDoor = null;
                }
            },
            
            moveForward() {
                Raycaster.movePlayer(
                    Math.cos(Raycaster.player.dir) * Raycaster.player.speed,
                    Math.sin(Raycaster.player.dir) * Raycaster.player.speed
                );
                this.player.energy -= 0.1;
            },
            
            moveBackward() {
                Raycaster.movePlayer(
                    -Math.cos(Raycaster.player.dir) * Raycaster.player.speed * 0.6,
                    -Math.sin(Raycaster.player.dir) * Raycaster.player.speed * 0.6
                );
            },
            
            moveLeft() {
                Raycaster.movePlayer(
                    Math.cos(Raycaster.player.dir - Math.PI/2) * Raycaster.player.speed * 0.8,
                    Math.sin(Raycaster.player.dir - Math.PI/2) * Raycaster.player.speed * 0.8
                );
            },
            
            moveRight() {
                Raycaster.movePlayer(
                    Math.cos(Raycaster.player.dir + Math.PI/2) * Raycaster.player.speed * 0.8,
                    Math.sin(Raycaster.player.dir + Math.PI/2) * Raycaster.player.speed * 0.8
                );
            },
            
            tryInteract() {
                if (this.nearDoor) {
                    // Entrar na casa
                    const houseTypes = ['villager', 'rich', 'abandoned'];
                    const type = houseTypes[Math.floor(Math.random() * houseTypes.length)];
                    HouseSystem.enter(type);
                } else {
                    const interact = Raycaster.checkInteraction();
                    if (interact?.type === 'water') {
                        this.player.thirst = Math.min(100, this.player.thirst + 30);
                        UI.notify("üíß Voc√™ bebeu √°gua!");
                    } else if (interact?.type === 'tree') {
                        this.player.inventory.wood = (this.player.inventory.wood || 0) + 2;
                        UI.notify("ü™µ +2 Madeira");
                    }
                }
            },
            
            attack() {
                // Sistema de combate simplificado em FP
                UI.notify("üëä Voc√™ atacou!");
                LuisAI.speak("Toma essa! ...Eu acho que acertei? Com essa c√¢mera em primeira pessoa eu n√£o vejo nada!");
            },
            
            interiorAction(action) {
                HouseSystem.action(action);
            },
            
            togglePause() {
                if (this.state === 'playing') {
                    this.state = 'paused';
                    UI.notify("‚è∏Ô∏è Jogo Pausado");
                } else if (this.state === 'paused') {
                    this.state = 'playing';
                }
            },
            
            gameOver(reason) {
                this.state = 'gameover';
                document.getElementById('deathReason').textContent = reason;
                document.getElementById('gameOverScreen').classList.add('active');
            },
            
            respawn() {
                this.player.hp = this.player.maxHp;
                this.player.hunger = 50;
                this.player.thirst = 50;
                this.player.energy = 50;
                Raycaster.player.x = 96;
                Raycaster.player.y = 96;
                
                document.getElementById('gameOverScreen').classList.remove('active');
                this.state = 'playing';
            },
            
            start() {
                this.player = {
                    hp: 100,
                    maxHp: 100,
                    hunger: 80,
                    thirst: 80,
                    energy: 100,
                    inventory: { wood: 0, meat: 2, cookedMeat: 1, water: 1 },
                    level: 1
                };
                
                document.getElementById('mainMenu').classList.remove('active');
                document.getElementById('gameHUD').style.display = 'block';
                document.getElementById('mobileControls').style.display = 'block';
                
                this.state = 'playing';
                
                // Intro do Luis
                setTimeout(() => {
                    LuisAI.speak("E a√≠, aventureiro! Sou o Luis. Vou te acompanhar nessa loucura. Sim, eu falo demais, mas √© porque eu sou... emocionalmente dispon√≠vel, segundo minha terapeuta.");
                }, 2000);
            },
            
            load() {
                // Sistema de save simplificado
                UI.notify("üíæ Carregando...");
                this.start();
            },
            
            showTutorial() {
                alert(`COMO JOGAR:

üéÆ CONTROLES:
WASD / Joystick - Mover
Mouse / Toque direito - Olhar
F / Bot√£o üñêÔ∏è - Interagir
Espa√ßo / Bot√£o üëä - Atacar

üè† CASAS:
Aproxime-se de portas (F) para entrar
Dentro voc√™ pode: Comer, Dormir, Cozinhar, Assistir TV

‚ö†Ô∏è SOBREVIV√äNCIA:
Monitore Fome, Sede e Energia
Coma e beba regularmente
Durma em camas para recuperar energia

üå™Ô∏è DESASTRES:
Fique atento a terremotos e tempestades
Procure abrigo em casas

üó£Ô∏è LUIS:
Seu companheiro que n√£o cala a boca
D√° dicas, zoia, mas √© leal`);
            }
        };

        // Iniciar
        window.onload = () => Game.init();
    </script>
</body>
</html>
